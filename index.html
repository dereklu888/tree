<html>
   <!--https://drive.google.com/file/d/126X-RQ0gHO2z_Bv51cf1qA-zf-QL8mA4/view?usp=sharing-->
  <head>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <link rel="stylesheet" type="text/css"href="index.css">
    <meta charset="UTF-8">
    <style>
    .chart div {
      font: 15px sans-serif;
      background-color: blue;
      margin: 1px;
      padding: 3px;
      text-align: right;
      color: white;
    }

    .links line {
      stroke: #999;
      stroke-opacity: 0.6;
    }

    .nodes circle {
      stroke: #fff;
      stroke-width: 1.5px;
    }

    .unselectable {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;

        font: 12px sans-serif;
    }

    .desc {
      font: 14px sans-serif;
    }
    </style>
  </head>

  <body>
    <script type="text/javascript">
      // Useful information at www.puzzlr.org/force-graphs-with-d3/

      // SVG frame dimensions
      var w = 1500;
      var h = 600;

      // Node selected border color
      var strokeWidth = 1.25;
      var strokeColor = "white";

      // Spacing of labels from node
      var labelSpacingX = 7;
      var labelSpacingY = 4;

      // Color of text
      var textColor = "lightgrey";
      var backgroundColor = "#202020";

      // Repulsiveness of nodes
      var nodeCharge = 65;

      // For future use
      var storedColor = "#202020";

      // Example text for testing
      var exampleText = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. \
      Suspendisse tortor est, fringilla sit amet nunc quis, vulputate sodales orci. \
      Phasellus quam purus, vulputate sit amet nunc in, feugiat aliquam mi. Ut vel elementum magna. \
      Nullam consectetur venenatis diam id auctor. Ut sagittis a nisi sit amet efficitur. \
      Aenean sit amet commodo risus. Donec dapibus ultrices odio, ut consequat libero viverra vel. ";

      // Data variables

      // Nodes information
      var nodes_data =  [
        {"name": "Lillian", "sex": "F"},
        {"name": "Gordon", "sex": "F"},
        {"name": "Sylvester", "sex": "M"},
        {"name": "Mary", "sex": "F"},
        {"name": "Helen", "sex": "F"},
        {"name": "Jamie", "sex": "M"},
        {"name": "Jessie", "sex": "F"},
        {"name": "Ashton", "sex": "M"},
        {"name": "Duncan", "sex": "M"},
        {"name": "Evette", "sex": "F"},
        {"name": "Mauer", "sex": "M"},
        {"name": "Fray", "sex": "F"},
        {"name": "Duke", "sex": "M"},
        {"name": "Baron", "sex": "M"},
        {"name": "Infante", "sex": "M"},
        {"name": "Percy", "sex": "M"},
        {"name": "Cynthia", "sex": "F"},
        {"name": "Thompson", "sex" : "M"},
        {"name": "Joe", "sex" : "M"},
        {"name": "John", "sex" : "M"},
        {"name": "Alexis", "sex" : "M"},
        {"name": "Jonathan", "sex" : "M"},
        {"name": "Jack", "sex" : "M"}
      ]

      // Links information
      var link_data = [
        {"source": "Sylvester", "target": "Gordon", "type":"A" },
        {"source": "Sylvester", "target": "Lillian", "type":"A" },
        {"source": "Sylvester", "target": "Mary", "type":"A"},
        {"source": "Sylvester", "target": "Jamie", "type":"A"},
        {"source": "Sylvester", "target": "Jessie", "type":"A"},
        {"source": "Sylvester", "target": "Helen", "type":"A"},
        {"source": "Helen", "target": "Gordon", "type":"A"},
        {"source": "Mary", "target": "Lillian", "type":"A"},
        {"source": "Ashton", "target": "Mary", "type":"A"},
        {"source": "Duncan", "target": "Jamie", "type":"A"},
        {"source": "Gordon", "target": "Jessie", "type":"A"},
        {"source": "Sylvester", "target": "Fray", "type":"E"},
        {"source": "Fray", "target": "Mauer", "type":"A"},
        {"source": "Fray", "target": "Cynthia", "type":"A"},
        {"source": "Fray", "target": "Percy", "type":"A"},
        {"source": "Percy", "target": "Cynthia", "type":"A"},
        {"source": "Infante", "target": "Duke", "type":"A"},
        {"source": "Duke", "target": "Gordon", "type":"A"},
        {"source": "Duke", "target": "Sylvester", "type":"A"},
        {"source": "Baron", "target": "Duke", "type":"A"},
        {"source": "Baron", "target": "Sylvester", "type":"E"},
        {"source": "Evette", "target": "Sylvester", "type":"E"},
        {"source": "Cynthia", "target": "Sylvester", "type":"E"},
        {"source": "Cynthia", "target": "Jamie", "type":"E"},
        {"source": "Mauer", "target": "Jessie", "type":"E"},
        {"source": "Thompson", "target": "Joe", "type":"A"},
        {"source": "Joe", "target": "John", "type":"A"},
        {"source": "Alexis", "target": "Jonathan", "type":"A"},
        {"source": "Alexis", "target": "Joe", "type":"A"},
        {"source": "Alexis", "target": "John", "type":"A"},
        {"source": "Jack", "target": "Alexis", "type":"E"},
        {"source": "Thompson", "target": "Jack", "type":"A"}
      ]

        // Force graph
        var svg2 = d3.select("body")
                    .append("svg")
                    .attr("width", w)
                    .attr("height", h);

        d3.select("body").style("background-color", backgroundColor);

        var simulation = d3.forceSimulation()
                          .nodes(nodes_data);

        // Used to store currently selected node
        var past = null;

        // Text objects for displaying selected node data
        var detailLabel = d3.select("body").append("p").text("Select a node to begin.").attr("class", "desc").style("color", textColor);
        var detailLabelDesc = d3.select("body").append("p").text("").attr("class", "desc").style("color", textColor);

        // Set repulsiveness force, charge strength
        simulation.force("charge_force", d3.forceManyBody()
          .strength(-nodeCharge));

        // Apply force pointing toward center
        simulation.force("center_force", d3.forceCenter(w/2, h/2));

        var link_force = d3.forceLink(link_data)
                          .id(function(d) {return d.name});

        simulation.force("links", link_force);

        // Draw links
        var link = svg2.append("g")
          .attr("class", "links")
          .selectAll("line")
          .data(link_data)
          .enter()
          .append("line")
          .attr("stroke-width", 2);

        // Create label + node group
        var gnodes = svg2.selectAll("g.gnode")
          .data(nodes_data)
          .enter()
          .append("g")
          .classed("gnode", true);

        // Draw labels
        var labels = gnodes.append("text")
          .attr("class", "unselectable")
          .text(function(d) { return d.name; })
          .style("fill", textColor);

        // Draw nodes
        var node = gnodes.append("circle")
          .attr("class", "node")
          .attr("r", 5)
          .attr("fill", function(d) {
            // Set node color based on name length
            // Should be changed later
            if(d.name.length > 6) {
              return "pink";
            } else if(d.name.length > 5) {
              return "orange";
            }
            return "red";
          })
          // Select and on click node actions
          .on("mousedown", function(d) {
            // Unselect previous node if selected
            if(past != null) {
              past.style("stroke-width", 0);
            }

            // Remove previous text
            detailLabel.remove();
            detailLabelDesc.remove();

            // Add border to selected node
            past = d3.select(this).style("stroke", strokeColor)
              .style("stroke-width", strokeWidth);

            // Set text
            detailLabel = d3.select("body").append("p").text("Selected node: " + d.name).attr("class", "desc").style("color", textColor);
            detailLabelDesc = d3.select("body").append("p").text(makeRandSentence(10)).attr("class", "desc").style("color", textColor);
          });

        simulation.on("tick", tickActions);

        // Set drag handlers
        var drag_handler = d3.drag()
          .on("start", drag_start)
          .on("drag", drag_drag)
          .on("end", drag_end);

        drag_handler(node);

        // Random text functions for testing
        function makeRandText(count) {
          var text = "";
          var possible = "abcdefghijklmnopqrstuvwxyz";

          for (var i = 0; i < count; i++)
            text += possible.charAt(Math.floor(Math.random() * possible.length));

          return text;
        }

        function makeRandSentence(count) {
          var text = "";
          var maxWordLen = 12;
          var maxWordCount = 12;

          var words;

          for(var i = 0; i < count; i++) {
            words = Math.ceil(Math.random()*maxWordCount);
            for(var j = 0; j < words; j++) {
              text += makeRandText(Math.floor(Math.random()*maxWordLen)) + " ";
            }
            text = text.substring(0, text.length - 2);
            text += ". "
          }

          return text;
        }

        // Tick handler
        function tickActions() {
          // Update node position
          node
            .attr("cx", function(d) { return d.x; })
            .attr("cy", function(d) { return d.y; })

          // Update link position
          link
            .attr("x1", function(d) { return d.source.x; })
            .attr("y1", function(d) { return d.source.y; })
            .attr("x2", function(d) { return d.target.x; })
            .attr("y2", function(d) { return d.target.y; });

          // Update link position
          labels
            .attr("x", function(d) { return d.x + labelSpacingX; })
            .attr("y", function(d) { return d.y + labelSpacingY; });
        }

        // Drag handlers
        function drag_start(d) {
          if (!d3.event.active) simulation.alphaTarget(0.3).restart();
          d.fx = d.x;
          d.fy = d.y;
        }

        function drag_drag(d) {
          d.fx = d3.event.x;
          d.fy = d3.event.y;
        }

        function drag_end(d) {
          if (!d3.event.active) simulation.alphaTarget(0);
          d.fx = null;
          d.fy = null;
        }

      </script>
  </body>

</html>
