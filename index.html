<html>
  <head>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css"href="index.css">
    <meta charset="UTF-8">
    <style>
    .chart div {
      font: 15px sans-serif;
      background-color: blue;
      margin: 1px;
      padding: 3px;
      text-align: right;
      color: white;
    }

    .links line {
      stroke: #999;
      stroke-opacity: 0.6;
    }

    .nodes circle {
      stroke: #fff;
      stroke-width: 1.5px;
    }

    .unselectable {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;

        font: 12px sans-serif;
    }

    .desc {
      font: 14px sans-serif;
    }
    </style>
  </head>

  <body>
    <title>Something Tree</title>
    <table class="credits">
      <ul>
        <li><a href="pages/about.html">About</a></li>
        <li><a href="pages/info.html">Info</a></li>
        <li><a href="pages/contact.html">Contact</a></li>
        <li><a href="https://www.buymeacoffee.com/">Donate</a></li>
      </ul>
        <div class="credits">Created by Derek, Vineeth, Richard, and Sid</div>

    </table>
    <script type="text/javascript">
      /* TODO: fix window resizing, add footer stuffs to index.html
        get data, make nodes bigger, beautify text

      */
      // Useful information at www.puzzlr.org/force-graphs-with-d3/

      // SVG frame dimensions
      var w = window.innerWidth
        || document.documentElement.clientWidth
        || document.body.clientWidth;
      
      // Subtract 15px from width as approximation of svg margins
      w = w - 15;

      var h = window.innerHeight
        || document.documentElement.clientHeight
        || document.body.clientHeight;
      
      // Set svg height as 75% of window height
      h = Math.floor(h * 0.75);

      // Node selected border color
      var strokeWidth = 1.25;
      var strokeColor = "white";
      
      // Border properties
      var borderOn = true;
      var borderColor = "#707070";
      var borderWidth = 1;
      
      // Graph frame properties
      var frameColor = "none";

      // Limits for zooming
      // First value is for zoom out,
      //  smaller value allows greater zoom out
      // Second value is for zoom in,
      //  reater value allows greater zoom in
      var zoomLimits = [0.5, 4];

      // Spacing of labels from node
      var labelSpacingX = 7;
      var labelSpacingY = 4;

      // Color of text
      var textColor = "lightgrey";
      var backgroundColor = "#202020";

      // Repulsiveness of nodes
      var nodeCharge = 65;

      // For future use
      var storedColor = "#202020";

      // Text display variables
      var initialText = "Select node to begin. (Press 'R' to reset zoom)";
      var initialDesc = "";

      // Example text for testing
      var exampleText = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. \
      Suspendisse tortor est, fringilla sit amet nunc quis, vulputate sodales orci. \
      Phasellus quam purus, vulputate sit amet nunc in, feugiat aliquam mi. Ut vel elementum magna. \
      Nullam consectetur venenatis diam id auctor. Ut sagittis a nisi sit amet efficitur. \
      Aenean sit amet commodo risus. Donec dapibus ultrices odio, ut consequat libero viverra vel. ";
      
      

      // Nodes information
      /*var nodes_data =  [
        {"name": "Lillian", "sex": "F"},
        {"name": "Gordon", "sex": "F"},
        {"name": "Sylvester", "sex": "M"},
        {"name": "Mary", "sex": "F"},
        {"name": "Helen", "sex": "F"},
        {"name": "Jamie", "sex": "M"},
        {"name": "Jessie", "sex": "F"},
        {"name": "Ashton", "sex": "M"},
        {"name": "Duncan", "sex": "M"},
        {"name": "Evette", "sex": "F"},
        {"name": "Mauer", "sex": "M"},
        {"name": "Fray", "sex": "F"},
        {"name": "Duke", "sex": "M"},
        {"name": "Baron", "sex": "M"},
        {"name": "Infante", "sex": "M"},
        {"name": "Percy", "sex": "M"},
        {"name": "Cynthia", "sex": "F"},
        {"name": "Thompson", "sex" : "M"},
        {"name": "Joe", "sex" : "M"},
        {"name": "John", "sex" : "M"},
        {"name": "Alexis", "sex" : "M"},
        {"name": "Jonathan", "sex" : "M"},
        {"name": "Jack", "sex" : "M"}
      ];*/

      var rand_nodes = [];

      // Links information
      /*var link_data = [
        {"source": "Sylvester", "target": "Gordon", "type":"A" },
        {"source": "Sylvester", "target": "Lillian", "type":"A" },
        {"source": "Sylvester", "target": "Mary", "type":"A"},
        {"source": "Sylvester", "target": "Jamie", "type":"A"},
        {"source": "Sylvester", "target": "Jessie", "type":"A"},
        {"source": "Sylvester", "target": "Helen", "type":"A"},
        {"source": "Helen", "target": "Gordon", "type":"A"},
        {"source": "Mary", "target": "Lillian", "type":"A"},
        {"source": "Ashton", "target": "Mary", "type":"A"},
        {"source": "Duncan", "target": "Jamie", "type":"A"},
        {"source": "Gordon", "target": "Jessie", "type":"A"},
        {"source": "Sylvester", "target": "Fray", "type":"E"},
        {"source": "Fray", "target": "Mauer", "type":"A"},
        {"source": "Fray", "target": "Cynthia", "type":"A"},
        {"source": "Fray", "target": "Percy", "type":"A"},
        {"source": "Percy", "target": "Cynthia", "type":"A"},
        {"source": "Infante", "target": "Duke", "type":"A"},
        {"source": "Duke", "target": "Gordon", "type":"A"},
        {"source": "Duke", "target": "Sylvester", "type":"A"},
        {"source": "Baron", "target": "Duke", "type":"A"},
        {"source": "Baron", "target": "Sylvester", "type":"E"},
        {"source": "Evette", "target": "Sylvester", "type":"E"},
        {"source": "Cynthia", "target": "Sylvester", "type":"E"},
        {"source": "Cynthia", "target": "Jamie", "type":"E"},
        {"source": "Mauer", "target": "Jessie", "type":"E"},
        {"source": "Thompson", "target": "Joe", "type":"A"},
        {"source": "Joe", "target": "John", "type":"A"},
        {"source": "Alexis", "target": "Jonathan", "type":"A"},
        {"source": "Alexis", "target": "Joe", "type":"A"},
        {"source": "Alexis", "target": "John", "type":"A"},
        {"source": "Jack", "target": "Alexis", "type":"E"},
        {"source": "Thompson", "target": "Jack", "type":"A"}
      ];*/
      
      var nodes_data = [{"name": "Trojan", "type": "Malware", "description": "Malware that pretends to be a useful or legitimate program, but in reality causes harm or makes the computer vulnerable."},
                        {"name": "Ransomware", "type": "Malware", "description": "Malware that locks a user from accessing his or her data and attempts to extort money from the user in exchange for access."},
                        {"name": "Backdoors", "type": "Malware", "description": "Malware that creates more vulnerabilities in a user’s system which allows for the introduction of malware later on."},
                        {"name": "Rootkits", "type": "Malware", "description": "Malware that is able to modify the user’s operating system so that it remains hidden from the user, allowing it to run malicious code without detection."},
                        {"name": "Worm", "type": "Malware", "description": "Malware that replicates itself across a network of computers in order to have a larger effect with whatever purpose it is trying to achieve."},
                        {"name": "Keylogger", "type": "Malware", "description": "A keylogger records the keystrokes of a user, allowing it to access important and personal information such as credit card information, bank information, passwords, etc."},
                        {"name": "Bot (Botnet)", "type": "Malware", "description": "A bot is a computer that has been infected with malicious code that, when paired with a large amount of other bots (a botnet), can be used to execute distributed denial of service attacks (DDoS attacks) or email spam."},
                        {"name": "Rogue Security Software", "type": "Malware", "description": "A type of program that pretends to detect and remove malware for a fee; it claims to scan for malware but rather shows you fake detections and warnings, telling you that you need to pay to register the software or remove the fake threats from your PC."},
                        {"name": "Macro Malware", "type": "Malware", "description": "Malware that takes advantage of the feature in Microsoft Office which allows you to automate certain tasks (Macros) by using it to download threats onto the user’s computer. These are usually sent as Microsoft Office attachments to emails which offers the user a sum of money and tells them that all they have to do is open the document for more details."},
                        {"name": "Wiper", "type": "Malware", "description": "Malware that wipes a computer’s hard drive. Usually used in conjunction with other malware, for example, a ransomware that would threaten to wipe the hard drive if the condition was not met."},
                        {"name": "Browser Hijacking", "type": "Malware", "description": "Malware that modifies users browser settings without permission. This is usually used to increase page visits for the owners website or to produce ad revenue. Often times used in conjunction with keyloggers to gather personal information such as access to emails and bank accounts"},
                        {"name": "Potentially Unwanted Programs", "type": "Malware", "description": "Programs that don’t classify as malware, but can create harms to computers. These programs are capable of slowing down computers as well as creating annoyances for the user."},
                        {"name": "Spyware", "type": "Malware", "description": "Software that collects user information after being installed on a computer. Often unnoticed, spyware sends information back to the attacker, often used to gain sensitive data such as passwords."},
                        {"name": "Adware", "type": "Malware", "description": "Software used to display unwanted advertisements on computers, gaining revenue for the attacker."},
                        {"name": "Viruses", "type": "Malware", "description": "Software that self replicates and attempts to spread to other computers. Not all viruses carry malicious payloads, though most are associated with other types of malware."},
                        {"name": "Boot Sector", "type": "Malware", "description": "Malware that conceals itself or executes in the boot sector, making it difficult to prevent. The boot sector is automatically executed at startup, allowing malicious programs to be run without usual operating system or antivirus protections."},
                        {"name": "Vulnerability", "type": "Malware", "description": "Potential exploit from errors or bugs in software that malware can use to create harmful effects, often serving as an entrance for malware to infect computers."},
                        {"name": "Denial of Service", "type": "Attack", "description": "Attempt to flood networks with traffic in excess of normal capacity, bringing the networks to a halt. Examples include the 2016 Dyn attack from the Mirai botnet. DoS attacks are used to halt of the operation of websites."},
                        {"name": "Phishing Emails", "type": "Social Engineering", "description": "Emails that appear to be coming from legitimate businesses offering services and deals that are often too good to be true, with the goal of either scamming money from the host or infecting the host with some sort of virus or keylogger to get other personal information from him or her."},
                        {"name": "Tech Support Scams", "type": "Social Engineering", "description": "Most tech support scams start with pop-ups that say that the user’s computer has been infected with some sort of virus and the only way to remove it is to call their number. When called, the user is greeted by someone who says they are from a reputable company like Apple or Microsoft and asks for control of the user’s computer in order to help them, when in reality it allows the scammer to steal their personal information."},
                        {"name": "Phishing Websites", "type": "Social Engineering", "description": "Websites that try to imitate the design of legitimate and popular websites (and use similar URLs) in order to get people’s login IDs and passwords or other personal information."},
                        {"name": "Baiting", "type": "Social Engineering", "description": "Manipulating users into using physical media such as CDs or USBs on computers, with malicious programs installed on these devices. Designed to exploit natural curiosity, victims take the bait laid out for them. Common examples include employees using unknown USBs on company computers. Files on the USB are often named to encourage users to click on the file, allowing malicious programs to run. "},
                        {"name": "Spear Phishing", "type": "Social Engineering", "description": "Highly targeted and specialized attempts to trick users into divulging sensitive information. Usually used to gain information from a specific group, spear phishing differs from phishing in the scope of its attack. Because of the small scale, spear phishing has higher success rates, often done with research to tailor campaigns to target audiences."},
                        {"name": "Watering Hole", "type": "Social Engineering", "description": "Rather than directly attack a user, watering hole attacks exploit indirect links to the target. Attackers look for vulnerabilities on websites visited by user, and place malicious software on the website to be transferred to the target. "},
                        {"name": "Pharming", "type": "Attack", "description": "A cyber attack that is intended to redirect from a genuine website to a fake website. Is generally used with malware to alter host files to ensure a redirect, or exploiting vulnerabilities in DNS servers ."},
                        {"name": "Logic Bomb", "type": "Attack", "description": "A piece of malicious code purposely planted in a software system. The code will execute a malicious function when a certain condition is met. For example it will start deleting files from a computer on a certain date."}];


      var link_data = [{"source": "Trojan", "target": "Keylogger", "type":"A" },
                      {"source": "Trojan", "target": "Spyware", "type":"A" },
                      {"source": "Trojan", "target": "Adware", "type":"A"},
                      {"source": "Trojan", "target": "Backdoors", "type":"A"},
                      {"source": "Trojan", "target": "Potentially Unwanted Programs", "type":"A" },
                      {"source": "Trojan", "target": "Viruses", "type":"A" },
                      {"source": "Trojan", "target": "Rogue Security Software", "type":"A" },
                      {"source": "Viruses", "target": "Backdoors", "type":"A"},
                      {"source": "Viruses", "target": "Rootkits", "type":"A"},
                      {"source": "Browser Hijacking", "target": "Adware", "type":"A" },
                      {"source": "Browser Hijacking", "target": "Spyware", "type":"A" },
                      {"source": "Ransomware", "target": "Wiper", "type":"A"},
                      {"source": "Ransomware", "target": "Backdoors", "type":"A"},
                      {"source": "Ransomware", "target": "Rootkits", "type":"A"},
                      {"source": "Ransomware", "target": "Vulnerability", "type":"A"},
                      {"source": "Ransomware", "target": "Boot Sector", "type":"A"},
                      {"source": "Worm", "target": "Backdoors", "type":"A"},
                      {"source": "Worm", "target": "Bot (Botnet)", "type":"A"},
                      {"source": "Worm", "target": "Backdoors", "type":"A"},
                      {"source": "Macro Malware", "target": "Worm", "type":"A"},
                      {"source": "Keylogger", "target": "Spyware", "type":"A"},
                      {"source": "Vulnerability", "target": "Boot Sector", "type":"A"},
                      {"source": "Vulnerability", "target": "Trojan", "type":"A"},
                      {"source": "Vulnerability", "target": "Viruses", "type":"A"},
                      {"source": "Vulnerability", "target": "Worm", "type":"A"},
                      {"source": "Vulnerability", "target": "Bot (Botnet)", "type":"A"},
                      {"source": "Bot (Botnet)", "target": "Denial of Service", "type":"A"},
                      {"source": "Phishing Emails", "target": "Spear Phishing", "type":"A" },
                      {"source": "Phishing Websites", "target": "Spear Phishing", "type":"A" },
                      {"source": "Baiting", "target": "Viruses", "type":"A"},
                      {"source": "Watering Hole", "target": "Vulnerability", "type":"A"},
                      {"source": "Tech Support Scams", "target": "Potentially Unwanted Programs", "type":"A" },
                      {"source": "Tech Support Scams", "target": "Rogue Security Software", "type":"A" },
                      {"source": "Pharming", "target": "Watering Hole", "type":"A" }];

                      
      /*var rand_links = [];

      makeRandNodes(50);
      makeRandLinks();

      var nodes_data = rand_nodes;
      var link_data = rand_links;*/
      
      // Force graph
      var svg2 = d3.select("body")
                  .append("svg")
                  .attr("width", w)
                  .attr("height", h)
                  .style("text-align", "center")
                  .call(d3.zoom().on("zoom", zoom_actions));
                  
      // Border draw
      if(borderOn) {
        var rect = svg2.append("rect")
          .attr("x", 0)
          .attr("y", 0)
          .attr("width", w)
          .attr("height", h)
          .attr("stroke", borderColor)
          .attr("stroke-width", borderWidth)
          .attr("fill", frameColor);
      }
      


      d3.select("body").style("background-color", backgroundColor);

      var simulation = d3.forceSimulation()
                        .nodes(nodes_data);

      // Used to store currently selected node
      var past = null;

      // Text objects for displaying selected node data
      var detailLabel = d3.select("body").append("p").text(initialText).attr("class", "desc").style("color", textColor);
      var detailLabelDesc = d3.select("body").append("p").text(initialDesc).attr("class", "desc").style("color", textColor);

      // Set repulsiveness force, charge strength
      simulation.force("charge_force", d3.forceManyBody()
        .strength(-nodeCharge));

      // Apply force pointing toward center
      simulation.force("center_force", d3.forceCenter(w/2, h/2));

      var link_force = d3.forceLink(link_data)
                        .id(function(d) {return d.name});

      simulation.force("links", link_force);

      // Draw links
      var link = svg2.append("g")
        .attr("class", "links")
        .selectAll("line")
        .data(link_data)
        .enter()
        .append("line")
        .attr("stroke-width", 2);

      // Create label + node group
      var gnodes = svg2.selectAll("g.gnode")
        .data(nodes_data)
        .enter()
        .append("g")
        .classed("gnode", true);

      // Draw labels
      var labels = gnodes.append("text")
        .attr("class", "unselectable")
        .text(function(d) { return d.name; })
        .style("fill", textColor)
        .style("translate","5px");


      var pastname = "start";

      // Draw nodes
      var node = gnodes.append("circle")
        .attr("class", "node")
        .attr("r", 8)
        .attr("fill", function(d) {
          // Set node color based on name length
          // Should be changed later
          if(d.type == "Malware") {
            return "red";
          } else if(d.type == "Attack") {
            return "orange";
          }
          return "pink";
          //return '#'+Math.random().toString(16).substr(-6);;
        })
        // Select and on click node actions
        .on("mousedown", function(d) {
          // Unselect previous node if selected
          if(past != null && pastname != d.name) {
            past.style("stroke-width", 0);
          }

          if(pastname != d.name || pastname=="start"){
            detailLabel.remove();
            detailLabelDesc.remove();

            // Add border to selected node
            past = d3.select(this)
              .style("stroke", strokeColor)
              .style("stroke-width", strokeWidth);
            pastname = d.name;

            // Set text
            detailLabel = d3.select("body").append("p").text("Selected node: " + d.name).attr("class", "desc").style("color", textColor);
            detailLabelDesc = d3.select("body").append("p").text(d.description).attr("class", "desc").style("color", textColor);
            $("p").hide();
            $("p").fadeIn(1000);

          }

        });

        simulation.on("tick", tickActions);

        // Zoom instanstiation
        var zoom_handler = d3.zoom()
          .scaleExtent(zoomLimits)
          .on("zoom", zoom_actions);

        // Call zoom on svg frame
        svg2.call(zoom_handler);

        // Set drag handlers
        var drag_handler = d3.drag()
          .on("start", drag_start)
          .on("drag", drag_drag)
          .on("end", drag_end);

        drag_handler(node);

        window.onkeyup = function(e) {
          let key = e.key.toUpperCase();

          if (key == 'R') {
            svg2.call(zoom_handler.transform, d3.zoomIdentity.scale(1));
          }
        }

        // Random text functions for testing
        function makeRandText(count) {
          var text = "";
          var possible = "abcdefghijklmnopqrstuvwxyz";

          for (var i = 0; i < count; i++)
            text += possible.charAt(Math.floor(Math.random() * possible.length));

          return text;
        }

        function makeRandSentence(count) {
          var text = "";
          var maxWordLen = 12;
          var maxWordCount = 12;

          var words;

          for(var i = 0; i < count; i++) {
            words = Math.ceil(Math.random()*maxWordCount);
            for(var j = 0; j < words; j++) {
              text += makeRandText(Math.floor(Math.random()*maxWordLen)) + " ";
            }
            text = text.substring(0, text.length - 2);
            text += ". "
          }

          return text;
        }

        function makeRandNodes(count) {
          var values;
          for(var i = 0; i < count; i++) {
            //values = {"name": makeRandText(10), "sex": Math.floor(Math.random * 2) = 0 ? 'M' : ' F'};
            values = {"name": makeRandText(Math.ceil(Math.random()*10))};
            rand_nodes.push(values);
          }
        }

        function makeRandLinks() {
          var num = Math.floor(rand_nodes.length * 1.25);
          var s;
          var t;
          var values;
          for(var i = 0; i < num; i++) {
            s = Math.floor(Math.random() * rand_nodes.length);
            t = Math.floor(Math.random() * rand_nodes.length);
            while(s == t) {
              t = Math.floor(Math.random() * rand_nodes.length);
            }
            values = {"source": rand_nodes[s]["name"], "target": rand_nodes[t]["name"]};
            rand_links.push(values);
          }
        }
        
        function makeRandColor() {
          var c = '';
          while (c.length < 7) {
            c += (Math.random()).toString(16).substr(-6).substr(-1)
          }
          return '#'+c;
        }


        // Tick handler
        function tickActions() {
          // Update node position
          node
            .attr("cx", function(d) { return d.x; })
            .attr("cy", function(d) { return d.y; })

          // Update link position
          link
            .attr("x1", function(d) { return d.source.x; })
            .attr("y1", function(d) { return d.source.y; })
            .attr("x2", function(d) { return d.target.x; })
            .attr("y2", function(d) { return d.target.y; });

          // Update link position
          labels
            .attr("x", function(d) { return d.x + labelSpacingX; })
            .attr("y", function(d) { return d.y + labelSpacingY; });
        }

        // Drag handlers
        function drag_start(d) {
          if (!d3.event.active) simulation.alphaTarget(0.3).restart();
          d.fx = d.x;
          d.fy = d.y;
        }

        function drag_drag(d) {
          d.fx = d3.event.x;
          d.fy = d3.event.y;
        }

        function drag_end(d) {
          if (!d3.event.active) simulation.alphaTarget(0);
          d.fx = null;
          d.fy = null;
        }

        // Zoom handler
        function zoom_actions(){
          node.attr("transform", d3.event.transform);
          link.attr("transform", d3.event.transform);
          labels.attr("transform", d3.event.transform);
        }

      </script>
      
  </body>

</html>
